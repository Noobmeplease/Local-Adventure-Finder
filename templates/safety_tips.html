{% extends "base.html" %}

{% block title %}Safety Tips & Emergency Contacts{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Safety Tips & Emergency Contacts</h1>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <section id="safety-tips" class="mb-5">
        <h2>General Adventure Safety Tips</h2>
        <div class="row row-cols-1 row-cols-md-2 g-4">
            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-compass"></i> Plan Your Trip</h5>
                        <p class="card-text">
                            Research your destination thoroughly. Understand the terrain, weather conditions, and any potential hazards. Share your itinerary with someone reliable.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-cloud-sun"></i> Check Weather Forecasts</h5>
                        <p class="card-text">
                            Weather can change rapidly, especially in mountains or remote areas. Always check the latest forecast before you go and be prepared for unexpected changes.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-briefcase"></i> Pack Essentials</h5>
                        <p class="card-text">
                            Carry a first-aid kit, navigation tools (map, compass, GPS), extra food and water, sun protection, and appropriate clothing layers. A multi-tool can also be very handy.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-person-check"></i> Know Your Limits</h5>
                        <p class="card-text">
                            Choose adventures that match your fitness level and experience. Don't push yourself too hard, especially if you are alone or in unfamiliar territory.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-telephone-fill"></i> Communication</h5>
                        <p class="card-text">
                            Carry a fully charged phone. For remote areas with no signal, consider a satellite phone or personal locator beacon (PLB).
                        </p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-shield-check"></i> Wildlife Awareness</h5>
                        <p class="card-text">
                            Be aware of local wildlife. Store food securely to avoid attracting animals. Know how to react if you encounter potentially dangerous wildlife.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="emergency-contacts">
        <h2>Emergency Contact Numbers (Bangladesh)</h2>
        <p>Keep these numbers handy. It is crucial to also save local emergency service numbers for the specific area you are visiting within Bangladesh.</p>
        <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="my-0">National Emergency Service</h6>
                    <small class="text-muted">For Police, Fire, Ambulance</small>
                </div>
                <span class="badge bg-danger rounded-pill fs-5">999</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="my-0">Fire Service (Dedicated)</h6>
                    <small class="text-muted">Verify locally for the most direct number</small>
                </div>
                <span class="badge bg-warning text-dark rounded-pill fs-5">102 / 199</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="my-0">RAB (Rapid Action Battalion)</h6>
                    <small class="text-muted">Specialized security force</small>
                </div>
                <span class="badge bg-primary rounded-pill fs-5">101</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="my-0">National Health Helpline</h6>
                    <small class="text-muted">For medical advice and emergency support</small>
                </div>
                <span class="badge bg-success rounded-pill fs-5">16263</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="my-0">Disaster Management Hotline</h6>
                    <small class="text-muted">For natural disasters and related emergencies</small>
                </div>
                <span class="badge bg-secondary rounded-pill fs-5">1090</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="my-0">Violence Against Women & Children</h6>
                    <small class="text-muted">Helpline for abuse and related issues</small>
                </div>
                <span class="badge bg-info text-dark rounded-pill fs-5">109</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="my-0">Child Helpline</h6>
                    <small class="text-muted">For children in need of help</small>
                </div>
                <span class="badge bg-purple text-white rounded-pill fs-5">1098</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="my-0">Tourist Police</h6>
                    <small class="text-muted">For assistance to tourists</small>
                </div>
                <span class="badge bg-teal text-white rounded-pill fs-5">+8801320222222</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="my-0">Government Services Information</h6>
                    <small class="text-muted">For information on government services</small>
                </div>
                <span class="badge bg-dark rounded-pill fs-5">333</span>
            </li>
        </ul>
        <p class="mt-3">
            <strong>Note:</strong> Some mapping apps, if location services are enabled, can provide your GPS coordinates to emergency services.
            It is highly recommended to have an In Case of Emergency (ICE) contact saved in your phone under that name, with both local and international dialing formats if applicable.
        </p>
    </section>

    <hr class="my-5">

    <section id="user-emergency-contacts" class="mb-5">
        <h2>Your Personal Emergency Contacts</h2>
        {% if user_contacts and user_contacts|length > 0 %}
            <ul class="list-group mb-3">
                {% for contact in user_contacts %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="my-0">{{ contact.contact_name }}</h6>
                            <small class="text-muted">{{ contact.relationship if contact.relationship else 'N/A' }} - {{ contact.phone_number }}</small>
                        </div>
                        <!-- Optional: Add edit/delete buttons here later -->
                        <form action="{{ url_for('delete_user_emergency_contact', contact_id=contact.id) }}" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this contact?');"><i class="bi bi-trash"></i></button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>You haven't added any personal emergency contacts yet.</p>
        {% endif %}

        <h4 class="mt-4">Add New Personal Contact</h4>
        <form method="POST" action="{{ url_for('add_user_emergency_contact') }}">
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="contact_name" class="form-label">Contact Name</label>
                    <input type="text" class="form-control" id="contact_name" name="contact_name" required>
                </div>
                <div class="col-md-4">
                    <label for="phone_number" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="phone_number" name="phone_number" required>
                </div>
                <div class="col-md-4">
                    <label for="relationship" class="form-label">Relationship (e.g., Spouse, Parent)</label>
                    <input type="text" class="form-control" id="relationship" name="relationship">
                </div>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Add Contact</button>
        </form>
    </section>

    <hr class="my-5">

    <section id="user-medical-reports" class="mb-5">
        <h2>Your Medical Reports</h2>
        {% if user_medical_reports and user_medical_reports|length > 0 %}
            <ul class="list-group mb-3">
                {% for report in user_medical_reports %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="my-0">{{ report.condition_name }}</h6>
                            <small class="text-muted">Notes: {{ report.notes if report.notes else 'N/A' }}</small><br>
                            <small class="text-muted">Last Updated: {{ report.reported_at.strftime('%Y-%m-%d %H:%M') }}</small>
                        </div>
                        <form action="{{ url_for('delete_user_medical_report', report_id=report.id) }}" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this medical report?');"><i class="bi bi-trash"></i></button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>You haven't added any medical reports yet.</p>
        {% endif %}

        <h4 class="mt-4">Add New Medical Report</h4>
        <form method="POST" action="{{ url_for('add_user_medical_report') }}">
            <div class="mb-3">
                <label for="condition_name" class="form-label">Condition Name / Medical Issue</label>
                <input type="text" class="form-control" id="condition_name" name="condition_name" required>
            </div>
            <div class="mb-3">
                <label for="notes" class="form-label">Notes (e.g., allergies, medication, severity, doctor's contact)</label>
                <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Add Medical Report</button>
        </form>
    </section>

</div>
{% endblock %}
